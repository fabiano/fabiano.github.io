<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quadrinhos</title>
  <link rel="stylesheet" href="assets/bulma.min.css" />
  <style>
    img.is-hidden-mobile {
      max-height: none !important;
    }
    nav.level {
      margin: 2em auto auto auto;
    }
  </style>
</head>
<body>
  <div>
    <nav class="navbar has-shadow is-spaced" role="navigation" aria-label="main navigation">
      <div class="container">
        <div class="navbar-brand">
          <div class="navbar-item">
            <img class="is-hidden-mobile is-hidden-tablet-only" src="assets/icon-256x256.png" width="64" height="64" alt="Quadrinhos">
            <img class="is-hidden-desktop" src="assets/icon-256x256.png" alt="Quadrinhos">
          </div>
          <div class="navbar-item">
            <span class="is-hidden-mobile is-hidden-tablet-only is-size-4 has-text-weight-semibold">Quadrinhos</span>
            <span class="is-hidden-desktop is-size-5 has-text-weight-semibold">Quadrinhos</span>
          </div>
        </div>
      </div>
    </nav>
    <div class="container">
      <nav class="level">
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Total</p>
            <p class="title" id="stats-total">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Em papel</p>
            <p class="title" id="stats-paper">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Digital</p>
            <p class="title" id="stats-digital">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">No. de páginas</p>
            <p class="title" id="stats-pages">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">No. de edições</p>
            <p class="title" id="stats-issues">0</p>
          </div>
        </div>
      </nav>
    </div>
    <section class="section">
      <div class="container">
        <h1 class="title is-uppercase">Recentes</h1>
        <table class="table is-bordered is-hoverable is-fullwidth">
          <thead>
            <tr>
              <th>Data</th>
              <th>Editora</th>
              <th>Título</th>
              <th>No. de páginas</th>
              <th>No. de edições</th>
              <th>Formato</th>
            </tr>
          </thead>
          <tbody id="latest-rows">
          </tbody>
        </table>
      </div>
    </section>
    <footer class="footer">
      <div class="container has-text-centered">
        <p>Made with <a class="has-text-dark" href="https://bulma.io">Bulma</a></p>
        <p>Logo by <a class="has-text-dark" href="https://www.iconfinder.com/icons/1055107/books_bookshelf_library_icon">Nick Roach</a></p>
      </div>
    </footer>
  </div>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    function createElement(tagName, { className, ...attributes }, children = []) {
      const element = document.createElement(tagName);

      if (className) {
        element.className = className;
      }

      for (const key of Object.keys(attributes)) {
        const attribute = key;
        const value = attributes[attribute];

        element.setAttribute(attribute, value);
      }

      for (const child of children) {
        if (typeof child === "string") {
          const text = document.createTextNode(child);

          element.appendChild(text);
        } else {
          element.appendChild(child);
        }
      }

      return element;
    }
  </script>
  <script>
    async function onLoad() {
      const API_KEY = "AIzaSyCI6ZNr9J7ebFAo2sbD4tJi0G8JNr34Gyc";
      const SPREADSHEET_ID = "10rvpYl85_2Bh8mtt8Wbg7jDKvZgmOxYOR4EOiduHd0I";
      const SPREADSHEET_RANGE = "2019!A2:G";

      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
      });

      const { result: { values } } = await gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: SPREADSHEET_RANGE,
      });

      const rows = document.getElementById("latest-rows");
      const stats = { total: values.length, paper: 0, digital: 0, pages: 0, issues: 0 };

      for (const [date, publisher, title, pages, issues, format, href] of values) {
        const row = createElement("tr", {}, [
          createElement("td", {}, [date]),
          createElement("td", {}, [publisher]),
          createElement("td", {}, [createElement("a", { href }, title)]),
          createElement("td", {}, [pages]),
          createElement("td", {}, [issues]),
          createElement("td", {}, [format]),
        ]);

        rows.insertBefore(row, rows.firstChild);

        if (format === "Digital") {
          stats.digital += 1;
        } else {
          stats.paper += 1;
        }

        stats.pages += parseInt(pages, 10);
        stats.issues += parseInt(issues, 10);
      }

      document.getElementById("stats-total").innerText = stats.total;
      document.getElementById("stats-paper").innerText = stats.paper;
      document.getElementById("stats-digital").innerText = stats.digital;
      document.getElementById("stats-pages").innerText = stats.pages;
      document.getElementById("stats-issues").innerText = stats.issues;
    }

    gapi.load("client", onLoad);
  </script>
</body>
</html>
