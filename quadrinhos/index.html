<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quadrinhos</title>
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="stylesheet" href="assets/bulma.min.css" />
  <style>
    img.is-hidden-mobile {
      max-height: none !important;
    }
  </style>
</head>
<body>
  <div>
    <progress class="progress is-small is-primary is-radiusless" id="progress" max="100">100%</progress>
    <div class="container">
      <nav class="level">
        <div class="level-item has-text-centered">
          <img class="is-hidden-mobile is-hidden-tablet-only" src="assets/icon-128x128.png" alt="Quadrinhos">
          <img class="is-hidden-desktop" src="assets/icon-64x64.png" alt="Quadrinhos">
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Total</p>
            <p class="title" id="stats-total">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Em papel</p>
            <p class="title" id="stats-paper">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Digital</p>
            <p class="title" id="stats-digital">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">No. de páginas</p>
            <p class="title" id="stats-pages">0</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">No. de edições</p>
            <p class="title" id="stats-issues">0</p>
          </div>
        </div>
      </nav>
    </div>
    <section class="section">
      <div class="container">
        <h1 class="title is-uppercase">Recentes</h1>
        <div class="table-container">
          <table class="table is-bordered is-hoverable is-fullwidth">
            <thead>
              <tr>
                <th>Data</th>
                <th>Editora</th>
                <th>Título</th>
                <th>No. de páginas</th>
                <th>No. de edições</th>
                <th>Formato</th>
              </tr>
            </thead>
            <tbody id="latest-rows">
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div class="container has-text-centered">
        <p>Made with <a class="has-text-dark" href="https://bulma.io" title="Bulma">Bulma</a></p>
        <p>Logo by <a class="has-text-dark" href="https://www.freepik.com" title="Freepik">Freepik</a> from <a class="has-text-dark" href="https://www.flaticon.com" title="Flaticon">Flaticon</a></p>
      </div>
    </footer>
  </div>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    function createElement(tagName, { className, ...attributes }, children = []) {
      const element = document.createElement(tagName);

      if (className) {
        element.className = className;
      }

      for (const key of Object.keys(attributes)) {
        const attribute = key;
        const value = attributes[attribute];

        element.setAttribute(attribute, value);
      }

      for (const child of children) {
        if (typeof child === "string") {
          const text = document.createTextNode(child);

          element.appendChild(text);
        } else {
          element.appendChild(child);
        }
      }

      return element;
    }

    function dayOfYear(date) {
      const oneDayInMilliseconds = 1000 * 60 * 60 * 24;
      const year = date.getFullYear();
      const month = date.getMonth();
      const day = date.getDate();
      const diff = Date.UTC(year, month, day) - Date.UTC(year, 0, 1);
      const value = diff / oneDayInMilliseconds;

      return value;
    }
  </script>
  <script>
    async function onLoad() {
      const API_KEY = "AIzaSyCI6ZNr9J7ebFAo2sbD4tJi0G8JNr34Gyc";
      const SPREADSHEET_ID = "10rvpYl85_2Bh8mtt8Wbg7jDKvZgmOxYOR4EOiduHd0I";
      const SPREADSHEET_RANGE = "2019!A2:G";

      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
      });

      const { result: { values } } = await gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: SPREADSHEET_RANGE,
      });

      let totalPaper = 0;
      let totalDigital = 0;
      let totalPages = 0;
      let totalIssues = 0;

      const rows = document.getElementById("latest-rows");

      for (const [date, publisher, title, pages, issues, format, href = "#"] of values) {
        const row = createElement("tr", {}, [
          createElement("td", {}, [date]),
          createElement("td", {}, [publisher]),
          createElement("td", {}, [createElement("a", { href }, [title])]),
          createElement("td", {}, [pages]),
          createElement("td", {}, [issues]),
          createElement("td", {}, [format]),
        ]);

        rows.insertBefore(row, rows.firstChild);

        if (format === "Digital") {
          totalDigital += 1;
        } else {
          totalPaper += 1;
        }

        totalPages += parseInt(pages, 10);
        totalIssues += parseInt(issues, 10);
      }

      document.getElementById("stats-total").innerText = values.length;
      document.getElementById("stats-paper").innerText = totalPaper;
      document.getElementById("stats-digital").innerText = totalDigital;
      document.getElementById("stats-pages").innerText = totalPages;
      document.getElementById("stats-issues").innerText = totalIssues;

      document.getElementById("progress").classList.add("is-invisible");
    }

    gapi.load("client", onLoad);
  </script>
</body>
</html>
